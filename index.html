<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UCI Analytics ‚Äî Registro & Tablero</title>

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#ffffff"/>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <!-- DataTables -->
  <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <!-- App CSS -->
  <link href="assets/css/style.css" rel="stylesheet"/>

  <!-- Google APIs -->
<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

<!-- Tu integraci√≥n con Sheets -->
<script src="js/gsheets.js"></script>


</head>
<body>
  <header>
    <div class="row align-items-center justify-content-between" style="margin:0">
      <div class="brand col-auto">
        <span class="logo">ü´Ä</span>
        <div>
          <div class="title h5 mb-0">UCI Analytics</div>
          <small class="text-muted">Registro diario & Tablero estad√≠stico</small>
        </div>
      </div>
      <div class="col-auto" style="padding-right:20px">
        <span class="pill" id="diag">estado: iniciando‚Ä¶</span>
      </div>
    </div>
    <div class="tabs">
      <button class="tablink active" data-tab="tablero"><i class="fa fa-chart-line"></i> Tablero</button>
      <button class="tablink" data-tab="registro"><i class="fa fa-pen-to-square"></i> Registro</button>
      <button id="btnSignIn" class="btn btn-sm btn-outline-primary">Acceder</button>
<button id="btnSignOut" class="btn btn-sm btn-outline-secondary" style="display:none">Salir</button>

    </div>
  </header>

  <main class="wrap">
    <!-- ============== TABLERO ============== -->
    <section id="tablero" class="panel">
      <div class="rowx" style="align-items:flex-end;margin-bottom:12px">
        <div><label class="form-label mb-1">Ingreso, desde</label><input type="date" id="fDesde" class="form-control"></div>
        <div><label class="form-label mb-1">Ingreso, hasta</label><input type="date" id="fHasta" class="form-control"></div>
        <div><label class="form-label mb-1">&nbsp;</label><button id="btnApply" class="btn btn-primary w-100"><i class="fa fa-filter"></i> Aplicar</button></div>
        <div><label class="form-label mb-1">&nbsp;</label><button id="btnReset" class="btn btn-outline-secondary w-100"><i class="fa fa-eraser"></i> Reset</button></div>
        <div class="ms-auto"><label class="form-label mb-1">√öltima actualizaci√≥n</label><div id="lastBuild" class="fw-bold">‚Äî</div></div>
      </div>

      <div class="kpis">
        <div class="kpi"><h6>Pacientes</h6><div class="val" id="kpiTotal">‚Äî</div></div>
        <div class="kpi"><h6>√ìbitos</h6><div class="val" id="kpiObitos">‚Äî</div></div>
        <div class="kpi"><h6>Mortalidad</h6><div class="val" id="kpiPrev">‚Äî</div></div>
        <div class="kpi"><h6>LOS medio</h6><div class="val" id="kpiLOS">‚Äî</div></div>
        <div class="kpi"><h6>APACHE II</h6><div class="val" id="kpiApache">‚Äî</div></div>
        <div class="kpi"><h6>SOFA 48h</h6><div class="val" id="kpiSofa">‚Äî</div></div>
        <div class="kpi"><h6>Ventilaci√≥n</h6><div class="val" id="kpiVI">‚Äî</div></div>
      </div>

      <div class="grid" style="margin-top:16px">
        <div class="card" style="grid-column: span 12;">
          <div class="d-flex align-items-center justify-content-between">
            <div class="sec-title">Admisiones por mes</div>
            <div class="btn-group">
              <button class="btn btn-sm btn-outline-primary chart-type active" data-type="area" data-chart="admisiones">√Årea</button>
              <button class="btn btn-sm btn-outline-primary chart-type" data-type="bar" data-chart="admisiones">Barras</button>
              <button class="btn btn-sm btn-outline-primary chart-type" data-type="line" data-chart="admisiones">L√≠neas</button>
            </div>
          </div>
          <div class="chart-container"><div id="chartAdmisiones"></div></div>
          <div class="text-muted" id="capAdmisiones">Periodo: ‚Äî</div>
        </div>

        <div class="card" style="grid-column: span 4;">
          <div class="sec-title">Distribuci√≥n de edades</div>
          <div class="chart-container"><div id="chartEdades"></div></div>
        </div>
        <div class="card" style="grid-column: span 4;">
          <div class="sec-title">Estancia (LOS)</div>
          <div class="chart-container"><div id="chartLOS"></div></div>
        </div>
        <div class="card" style="grid-column: span 4;">
          <div class="sec-title">Ventilaci√≥n invasiva</div>
          <div class="chart-container"><div id="chartVI"></div></div>
        </div>

        <div class="card" style="grid-column: span 12;">
          <div class="d-flex align-items-center justify-content-between">
            <div class="sec-title">Tabla de pacientes</div>
            <div class="btn-group">
              <button id="btnCSV" class="btn btn-outline-secondary btn-sm"><i class="fa fa-file-csv"></i> CSV</button>
              <button id="btnXLSX" class="btn btn-outline-secondary btn-sm"><i class="fa fa-file-excel"></i> Excel</button>
            </div>
          </div>
          <div class="tablex"><table id="tbl" class="table table-striped table-sm" style="width:100%"></table></div>
        </div>
      </div>
    </section>

    <!-- ============== REGISTRO ============== -->
    <section id="registro" class="panel" hidden>
      <!-- Modo Google Form (iframe) -->
      <div id="registro_form_embed" style="display:none">
        <div class="mb-2"><span class="pill"><i class="fa fa-circle-info"></i> Registro usando Google Forms</span></div>
        <div class="ratio ratio-1x1" style="min-height:680px;border:1px solid var(--line);border-radius:12px;overflow:hidden">
          <iframe id="gform" src="" frameborder="0" marginheight="0" marginwidth="0">Cargando‚Ä¶</iframe>
        </div>
      </div>

      <!-- Modo API propia -->
      <div id="registro_form_api" style="display:none">
        <div class="rowx">
          <div><label class="form-label">Correo electr√≥nico</label><input id="r_correo" class="form-control" type="email"></div>
          <div><label class="form-label">Nombre y Apellido</label><input id="r_nombre" class="form-control" type="text"></div>
          <div><label class="form-label">Fecha de nacimiento</label><input id="r_fnac" class="form-control" type="date"></div>
          <div><label class="form-label">Edad</label><input id="r_edad" class="form-control" type="number"></div>
        </div>
        <div class="rowx" style="margin-top:6px">
          <div><label class="form-label">Fecha de ingreso</label><input id="r_fing" class="form-control" type="date"></div>
          <div><label class="form-label">Fecha de egreso</label><input id="r_feg" class="form-control" type="date"></div>
          <div><label class="form-label">Registro de internaci√≥n</label><input id="r_reg" class="form-control" type="text"></div>
          <div><label class="form-label">Prontuario</label><input id="r_pron" class="form-control" type="text"></div>
        </div>
        <div class="rowx" style="margin-top:6px">
          <div><label class="form-label">APACHE II (24h)</label><input id="r_ap" class="form-control" type="number"></div>
          <div><label class="form-label">SOFA (48h)</label><input id="r_so" class="form-control" type="number"></div>
          <div><label class="form-label">LOS (d√≠as)</label><input id="r_dias" class="form-control" type="number"></div>
          <div><label class="form-label">M√©dico tratante</label><input id="r_med" class="form-control" type="text" placeholder="m√∫ltiples con ;"></div>
        </div>
        <div class="rowx" style="margin-top:6px">
          <div><label class="form-label">Condici√≥n al egreso</label><input id="r_cond" class="form-control" type="text" placeholder="m√∫ltiples con ;"></div>
          <div><label class="form-label">Origen del paciente</label><input id="r_origen" class="form-control" type="text" placeholder="m√∫ltiples con ;"></div>
          <div><label class="form-label">Tipo de paciente</label><input id="r_tipo" class="form-control" type="text" placeholder="m√∫ltiples con ;"></div>
          <div><label class="form-label">Lugar del egreso</label><input id="r_lugar" class="form-control" type="text" placeholder="m√∫ltiples con ;"></div>
        </div>
        <div class="rowx" style="margin-top:6px">
          <div><label class="form-label">Ventilaci√≥n invasiva</label><select id="r_vi" class="form-select"><option value=""></option><option>S√≠</option><option>No</option></select></div>
          <div><label class="form-label">V√≠a venosa central</label><select id="r_vvc" class="form-select"><option value=""></option><option>S√≠</option><option>No</option></select></div>
          <div><label class="form-label">Cat√©ter hemodi√°lisis</label><select id="r_cat" class="form-select"><option value=""></option><option>S√≠</option><option>No</option></select></div>
          <div><label class="form-label">KPC/MBL positivo</label><select id="r_kpc" class="form-select"><option value=""></option><option>S√≠</option><option>No</option><option>Pendiente</option></select></div>
        </div>
        <div class="rowx" style="margin-top:6px">
          <div><label class="form-label">Archivo</label><input id="r_arch" class="form-control" type="text"></div>
          <div style="flex:3"><label class="form-label">Observaciones</label><textarea id="r_obs" class="form-control" rows="3"></textarea></div>
          <div><label class="form-label">Traslado interno por estancia</label><select id="r_trasl" class="form-select"><option value=""></option><option>S√≠</option><option>No</option></select></div>
        </div>
        <div class="d-flex gap-2 mt-3">
          <button id="btnGuardar" class="btn btn-success"><i class="fa fa-save"></i> Guardar</button>
          <button id="btnLimpiar" class="btn btn-outline-secondary"><i class="fa fa-eraser"></i> Limpiar</button>
          <span class="pill" id="saveMsg">‚Äî</span>
          <button id="btnLogin" class="btn btn-outline-primary ms-auto"><i class="fa fa-user-lock"></i> Login API</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Login modal simple (para MODE=api) -->
  <div class="login-overlay" id="loginBox">
    <div class="login-card">
      <h4 class="mb-2">Acceso API</h4>
      <div class="text-muted mb-3">Ingresa la URL base del API y tu token (se guardan localmente).</div>
      <label class="form-label">API Base (https://‚Ä¶)</label>
      <input id="loginApi" class="form-control" placeholder="https://tu-api.ejemplo.com">
      <label class="form-label mt-2">Bearer Token</label>
      <input id="loginTok" class="form-control" type="password" placeholder="copiar/pegar token">
      <div class="d-flex gap-2 mt-3">
        <button id="doLogin" class="btn btn-primary w-100"><i class="fa fa-door-open"></i> Guardar</button>
        <button id="doLogout" class="btn btn-outline-danger w-100"><i class="fa fa-right-from-bracket"></i> Limpiar</button>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification"></div>

  <!-- Google Charts -->
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <!-- Bootstrap & deps -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <!-- jQuery + DataTables -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>

  <!-- App JS -->
  <script src="assets/js/main.js"></script>
</body>
</html>
